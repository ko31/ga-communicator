name: Setup PHP Scoper

on:
  workflow_call:
    inputs:
      scoper:
        required: true
        type: boolean

jobs:
  setup-php-scoper:
    name: Do PHP Scoper
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
        
      - name: Add Prefix
        if: inputs.scoper
        run: |
          composer global require humbug/php-scoper
          ~/.composer/vendor/bin/php-scoper add-prefix --output-dir=vendor-prefixed --force
          composer dump-autoload --working-dir vendor-prefixed --classmap-authoritative
          composer scoper-patch

      - name: Cleanup Vendor
        if: inputs.scoper
        run: rm -rf vendor

      - name: Skip PHP Scoper
        if: ! inputs.scoper
        run: echo "Skipping Scoper"
